# üß© IDA\* Solver –∑–∞ N-–ø—ä–∑–µ–ª

–†–µ—à–µ–Ω–∏–µ –∑–∞ **N-–ø—ä–∑–µ–ª–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä 8-–ø—ä–∑–µ–ª, 15-–ø—ä–∑–µ–ª) —á—Ä–µ–∑ **IDA\*** –∞–ª–≥–æ—Ä–∏—Ç—ä–º ‚Äî –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ A\*, –∫–æ—è—Ç–æ –∫–æ–º–±–∏–Ω–∏—Ä–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç –∏ –º–∏–Ω–∏–º–∞–ª–Ω–∞ –ø–∞–º–µ—Ç.

IDA\* (Iterative Deepening A\*) –µ —Ç—ä—Ä—Å–µ—â –∞–ª–≥–æ—Ä–∏—Ç—ä–º, –∫–æ–π—Ç–æ:

- –ò–∑–ø–æ–ª–∑–≤–∞ **–≥—Ä–∞–Ω–∏—á–Ω–æ (bounded) –¥—ä–ª–±–æ—á–∏–Ω–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ (DFS)**;
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∞–≤–∞ –ª–∏–º–∏—Ç–∞ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ `f = g + h`;
- –ò–∑–ø–æ–ª–∑–≤–∞ **–µ–≤—Ä–∏—Å—Ç–∏–∫–∞** (–ú–∞–Ω—Ö–∞—Ç—ä–Ω —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ), –∑–∞ –¥–∞ —Ä—ä–∫–æ–≤–æ–¥–∏ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ;
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞ **–æ–ø—Ç–∏–º–∞–ª–Ω–æ —Ä–µ—à–µ–Ω–∏–µ** (–∞–∫–æ –µ–≤—Ä–∏—Å—Ç–∏–∫–∞—Ç–∞ –µ –¥–æ–ø—É—Å—Ç–∏–º–∞).

---

## üß† –ö–∞–∫–≤–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–≤–∞ N-–ø—ä–∑–µ–ª—ä—Ç?

–ü—ä–∑–µ–ª—ä—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–≤–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–∞ –¥—ä—Å–∫–∞ `n √ó n`, —Å—ä–¥—ä—Ä–∂–∞—â–∞ —á–∏—Å–ª–∞—Ç–∞ `1...N` –∏ –ø—Ä–∞–∑–Ω–æ –º—è—Å—Ç–æ `0`.  
–¶–µ–ª—Ç–∞ –µ –¥–∞ —Å–µ –ø—Ä–µ–º–µ—Å—Ç—è—Ç –ø–ª–æ—á–∫–∏—Ç–µ —Ç–∞–∫–∞, —á–µ –¥—ä—Å–∫–∞—Ç–∞ –¥–∞ —Å—ä–≤–ø–∞–¥–Ω–µ —Å —Ü–µ–ª–µ–≤–∞—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.

–ü—Ä–∏–º–µ—Ä –∑–∞ 8-–ø—ä–∑–µ–ª:

```
1 2 3
4 5 6
7 0 8
```

‚Üí —Ü–µ–ª:

```
1 2 3
4 5 6
7 8 0
```

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –∫–æ–¥–∞

–ö–æ–¥—ä—Ç —Å–µ —Å—ä—Å—Ç–æ–∏ –æ—Ç –Ω—è–∫–æ–ª–∫–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ –º–æ–¥—É–ª–∞:

1. –ò–∑—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞ **–µ–≤—Ä–∏—Å—Ç–∏–∫–∞ (–ú–∞–Ω—Ö–∞—Ç—ä–Ω —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ)**
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –¥–∞–¥–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –µ **—Ä–µ—à–∏–º–æ**
3. –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ **–≤—ä–∑–º–æ–∂–Ω–∏ —Ö–æ–¥–æ–≤–µ (—Å—ä—Å–µ–¥–Ω–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è)**
4. –†–µ–∫—É—Ä—Å–∏–≤–µ–Ω **DFS —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ f = g + h**
5. –û—Å–Ω–æ–≤–Ω–∏—è—Ç **IDA\*** —Ü–∏–∫—ä–ª
6. –ì–ª–∞–≤–Ω–∞—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ ‚Äî —á–µ—Ç–µ–Ω–µ –Ω–∞ –≤—Ö–æ–¥, —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –∏ –∏–∑–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞

---

## 1Ô∏è‚É£ –ï–≤—Ä–∏—Å—Ç–∏–∫–∞ ‚Äî –ú–∞–Ω—Ö–∞—Ç—ä–Ω —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ

```python
def manhattan(board, goal_positions, n):
    total = 0
    for i, tile in enumerate(board):
        if tile == 0:
            continue
        goal_i = goal_positions[tile]
        x1, y1 = divmod(i, n)
        x2, y2 = divmod(goal_i, n)
        total += abs(x1 - x2) + abs(y1 - y2)
    return total
```

### üîπ –û–±—è—Å–Ω–µ–Ω–∏–µ —Ä–µ–¥ –ø–æ —Ä–µ–¥:

- enumerate(board) –æ–±—Ö–æ–∂–¥–∞ –≤—Å–∏—á–∫–∏ –ø–ª–æ—á–∫–∏.

- –ê–∫–æ –ø–ª–æ—á–∫–∞—Ç–∞ –µ 0, —Ç—è —Å–µ –ø—Ä–æ–ø—É—Å–∫–∞ (–Ω–µ —É—á–∞—Å—Ç–≤–∞ –≤ –µ–≤—Ä–∏—Å—Ç–∏–∫–∞—Ç–∞).

- goal_positions ‚Äî —Ä–µ—á–Ω–∏–∫ {tile: index} –Ω–∞ —Ü–µ–ª–µ–≤–∞—Ç–∞ –ø–æ–∑–∏—Ü–∏—è. goal_positions[tile] –¥–∞–≤–∞ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ –º—è—Å—Ç–æ—Ç–æ, –∫—ä–¥–µ—Ç–æ —Ç–∞–∑–∏ –ø–ª–æ—á–∫–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ.

- divmod(i, n) –≤—Ä—ä—â–∞ (—Ä–µ–¥, –∫–æ–ª–æ–Ω–∞) –∑–∞ –¥–∞–¥–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å.

- –î–æ–±–∞–≤—è–º–µ —Ä–∞–∑–ª–∏–∫–∏—Ç–µ –ø–æ —Ä–µ–¥ –∏ –∫–æ–ª–æ–Ω–∞ –∫—ä–º total.

### üìà –ï–≤—Ä–∏—Å—Ç–∏–∫–∞—Ç–∞ –µ O(N) –æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–æ –ø–æ-–∫—ä—Å–Ω–æ —â–µ –≤–∏–¥–∏–º –∫–∞–∫ —è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–º–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª–Ω–æ.

---

## 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –ø—ä–∑–µ–ª—ä—Ç –µ —Ä–µ—à–∏–º

```python
def is_solvable(board, n, zero_pos):
    tiles = [x for x in board if x != 0]
    inversions = 0
    for i in range(len(tiles)):
        for j in range(i + 1, len(tiles)):
            if tiles[i] > tiles[j]:
                inversions += 1

    if n % 2 == 1:
        return inversions % 2 == 0
    else:
        zero_row = zero_pos // n
        return (inversions + zero_row) % 2 == 1
```

- –°—ä–±–∏—Ä–∞ –ø–ª–æ—á–∫–∏—Ç–µ (–±–µ–∑ 0) –≤ —Å–ø–∏—Å—ä–∫ tiles.

- –ò–∑—á–∏—Å–ª—è–≤–∞ –±—Ä–æ—è –Ω–∞ –∏–Ω–≤–µ—Ä—Å–∏–∏—Ç–µ: –±—Ä–æ–π –¥–≤–æ–π–∫–∏ (i<j) —Å tiles[i] > tiles[j].

- –ê–∫–æ n –µ –Ω–µ—á–µ—Ç–Ω–æ ‚Üí –ø—ä–∑–µ–ª—ä—Ç –µ —Ä–µ—à–∏–º ‚Üî –∏–Ω–≤–µ—Ä—Å–∏–∏—Ç–µ —Å–∞ —á–µ—Ç–Ω–∏.

- –ê–∫–æ n –µ —á–µ—Ç–Ω–æ ‚Üí –ø—ä–∑–µ–ª—ä—Ç –µ —Ä–µ—à–∏–º ‚Üî (inversions + zero_row) % 2 == 1, –∫—ä–¥–µ—Ç–æ zero_row = zero_pos // n (–∏–Ω–¥–µ–∫—Å–∏—Ä–∞–Ω–æ –æ—Ç 0, —Å—á–∏—Ç–∞–Ω–æ –æ—Ç –≥–æ—Ä–Ω–∏—è —Ä–µ–¥).

---

## 3Ô∏è‚É£ –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä—Å–µ–¥–Ω–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è

```python
def get_neighbors(board, zero_idx, n):
    moves = [(-1, 0, "down"), (1, 0, "up"), (0, -1, "right"), (0, 1, "left")]
    neighbors = []

    x0, y0 = divmod(zero_idx, n)
    for dx, dy, move in moves:
        x, y = x0 + dx, y0 + dy
        if 0 <= x < n and 0 <= y < n:
            new_idx = x * n + y
            neighbors.append((new_idx, move))
    return neighbors
```

- –í—Ä—ä—â–∞ —Å–ø–∏—Å—ä–∫ –æ—Ç —Å—ä—Å–µ–¥–Ω–∏ –ø–æ–∑–∏—Ü–∏–∏, –Ω–æ –Ω–µ –≤—Ä—ä—â–∞ –≥–æ—Ç–æ–≤–∏ –±–æ—Ä–¥–æ–≤–µ ‚Äî —Å–∞–º–æ new_idx –∏ move (–∏–º–µ—Ç–æ –Ω–∞ —Ö–æ–¥–∞).

- –ó–∞—â–æ —Ç–∞–∫–∞: —Å —Ç–∞–∑–∏ –≤–µ—Ä—Å–∏—è –∏–∑–±–µ–≥–≤–∞–º–µ –Ω–µ–Ω—É–∂–Ω–∏ –∫–æ–ø–∏—Ä–∞–Ω–∏—è –Ω–∞ —Ü—è–ª–∞—Ç–∞ –¥—ä—Å–∫–∞ –≤ get_neighbors. –í dfs() —Å–µ –ø—Ä–∞–≤–∏ –∫–æ–ø–∏—Ä–∞–Ω–µ —Å–∞–º–æ –ø—Ä–∏ –≤–∞–ª–∏–¥–µ–Ω —Ö–æ–¥ (–∏ –µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ), —Ç–∞–∫–∞ —á–µ –±—Ä–æ—è—Ç –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∏ –æ–±–µ–∫—Ç–∏ –Ω–∞–º–∞–ª—è–≤–∞.

–§–æ—Ä–º–∞—Ç –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞:

`[(new_zero_idx1, "move1"), (new_zero_idx2, "move2"), ...]`

new_zero_idx –µ –∏–Ω–¥–µ–∫—Å—ä—Ç –∫—ä–¥–µ—Ç–æ 0 —â–µ –±—ä–¥–µ —Å–ª–µ–¥ —Ä–∞–∑–º—è–Ω–∞—Ç–∞ (—Ç.–µ. —Ç–µ–∫—É—â–∏—è—Ç –∏–Ω–¥–µ–∫—Å –Ω–∞ –ø–ª–æ—á–∫–∞—Ç–∞, –∫–æ—è—Ç–æ —â–µ –±—ä–¥–µ –ø—Ä–µ–º–µ—Å—Ç–µ–Ω–∞).

---

## 4Ô∏è‚É£ –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è DFS

```python
def dfs(path, g, bound, zero_idx, n, goal, goal_positions, current_h):
    board = path[-1]
    f = g + current_h

    if f > bound:
        return f, None

    if board == goal:
        return True, []

    min_over = float('inf')

    for new_zero, move in get_neighbors(board, zero_idx, n):
        new_board = list(board)
        moved_tile = new_board[new_zero]
        new_board[zero_idx], new_board[new_zero] = new_board[new_zero], new_board[zero_idx]
        new_board = tuple(new_board)

        if len(path) > 1 and new_board == path[-2]:
            continue

        goal_i = goal_positions[moved_tile]
        gx, gy = divmod(goal_i, n)

        old_x, old_y = divmod(zero_idx, n)
        new_x, new_y = divmod(new_zero, n)

        old_dist = abs(old_x - gx) + abs(old_y - gy)
        new_dist = abs(new_x - gx) + abs(new_y - gy)

        new_h = current_h - old_dist + new_dist

        path.append(new_board)
        result, moves = dfs(path, g + 1, bound, new_zero, n, goal, goal_positions, new_h)
        path.pop()

        if result is True:
            return True, [move] + moves

        if result < min_over:
            min_over = result

    return min_over, None
```

–¢–æ–≤–∞ –µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—Ç–∞ DFS —Ñ—É–Ω–∫—Ü–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ bound. –û–±—è—Å–Ω–µ–Ω–∏–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –≤–∞–∂–Ω–∏ —Å—Ç—ä–ø–∫–∏:

1. board = path[-1] ‚Äî —Ç–µ–∫—É—â–∞—Ç–∞ –¥—ä—Å–∫–∞ (tuple).

2. f = g + current_h.

   - –ê–∫–æ f > bound: –≤—Ä—ä—â–∞–º–µ f (–Ω–∞–≥–æ—Ä–µ —â–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∑–∞ –∏–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ —Å–ª–µ–¥–≤–∞—â–æ—Ç–æ bound).

3. –ê–∫–æ board == goal: –≤—ä—Ä–Ω–∏ True, [] (—É—Å–ø–µ—Ö; –µ–¥–∏–Ω –ø—Ä–∞–∑–µ–Ω —Å–ø–∏—Å—ä–∫ ‚Äî –Ω–∞–¥–æ–ª—É —â–µ —Å–µ –¥–æ–±–∞–≤—è—Ç —Ö–æ–¥–æ–≤–µ—Ç–µ).

4. min_over = inf ‚Äî —â–µ –ø–∞–∑–∏–º –Ω–∞–π-–º–∞–ª–∫–æ—Ç–æ f –∫–æ–µ—Ç–æ –µ –ø–æ-–≥–æ–ª—è–º–æ –æ—Ç bound (–∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ—Ç–æ —Å–ª–µ–¥–≤–∞—â–æ bound).

5. –ó–∞ –≤—Å–µ–∫–∏ —Å—ä—Å–µ–¥ new_zero, move in get_neighbors(...):

   - –°—ä–∑–¥–∞–≤–∞–º–µ new_board = list(board) –∏ moved_tile = new_board[new_zero].

   - –†–∞–∑–º–µ–Ω—è–º–µ new_board[zero_idx] –∏ new_board[new_zero] ‚Üí –ø–ª–æ—á–∫–∞—Ç–∞ –∏ 0 —Å–∏ —Å–º–µ–Ω—è—Ç –º–µ—Å—Ç–∞—Ç–∞.

   - new_board = tuple(new_board) ‚Äî –Ω–∞–ª–∞–≥–∞ —Å–µ immutable –∑–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞–Ω–µ –≤ path.

   - –ê–∫–æ len(path) > 1 –∏ new_board == path[-2] ‚Üí –ø—Ä–µ—Å–∫–æ—á–∏ (–Ω–µ –≤—Ä—ä—â–∞–π –æ–±—Ä–∞—Ç–Ω–æ –∫—ä–º –ø—Ä–µ–¥–∏—à–Ω–æ—Ç–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ).

   - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª–Ω–∞ –µ–≤—Ä–∏—Å—Ç–∏–∫–∞:

     - goal_i = goal_positions[moved_tile] ‚Üí —Ü–µ–ª–µ–≤–∞—Ç–∞ –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –ø—Ä–µ–º–µ—Å—Ç–µ–Ω–∞—Ç–∞ –ø–ª–æ—á–∫–∞.

     - old_x,old_y = divmod(new_zero,n) ‚Äî –∫—ä–¥–µ –µ –±–∏–ª–∞ –ø–ª–æ—á–∫–∞—Ç–∞ –ø—Ä–µ–¥–∏ (new_zero).

     - new_x,new_y = divmod(zero_idx,n) ‚Äî –∫—ä–¥–µ –æ—Ç–∏–≤–∞ —Ç—è (zero_idx).

     - old_dist –∏ new_dist —Å–∞ –ú–∞–Ω—Ö–∞—Ç—ä–Ω —Ä–∞–∑—Å—Ç–æ—è–Ω–∏—è—Ç–∞ —Å–ø—Ä—è–º–æ —Ü–µ–ª—Ç–∞; new_h = current_h - old_dist + new_dist.

   - path.append(new_board) ‚Äî –≤–ª–∏–∑–∞–º–µ –≤ –Ω–æ–≤–æ—Ç–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ.

   - –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ: result, moves = dfs(path, g+1, bound, new_zero, n, goal, goal_positions, new_h).

   - path.pop() ‚Äî –≤—Ä—ä—â–∞–Ω–µ (backtracking).

   - –ê–∫–æ result is True ‚Üí –≤—ä—Ä–Ω–∏ True, [move] + moves (—Å–≥–ª–æ–±—è–≤–∞ –ø—ä—Ç—è –æ—Ç–¥–æ–ª—É –Ω–∞–≥–æ—Ä–µ).

   - –ê–∫–æ result < min_over ‚Üí min_over = result.

6. –°–ª–µ–¥ —Ä–∞–∑–≥–ª–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ —Å—ä—Å–µ–¥–∏ ‚Üí return min_over, None.

---

## 5Ô∏è‚É£ –ì–ª–∞–≤–µ–Ω —Ü–∏–∫—ä–ª IDA\*

```python
def ida_star(start, goal, n, goal_positions, zero_pos):
    h0 = manhattan(start, goal_positions, n)
    bound = h0
    path = [start]

    while True:
        result, moves = dfs(path, 0, bound, zero_pos, n, goal, goal_positions, h0)
        if result is True:
            return moves
        if result == float('inf'):
            return -1
        bound = result
```

- –í–∑–µ–º–∞ –Ω–∞—á–∞–ª–Ω–æ—Ç–æ h0 = manhattan(start, goal_positions, n).

- bound = h0.

- path = [start].

- –¶–∏–∫—ä–ª:

  - result, moves = dfs(path, 0, bound, zero_pos, n, goal, goal_positions, h0).

  - –ê–∫–æ result is True ‚Üí –≤—Ä—ä—â–∞–º–µ moves.

  - –ê–∫–æ result == inf ‚Üí –Ω–µ—Å—ä–≤–º–µ—Å—Ç–∏–º–æ/–Ω–µ—Ä–µ—à–∏–º–æ ‚Üí –≤—Ä—ä—â–∞–º–µ -1.

  - –ò–Ω–∞—á–µ bound = result (—Å–ª–µ–¥–≤–∞—â–∞—Ç–∞ –≥—Ä–∞–Ω–∏—Ü–∞) –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ.

–ë–µ–ª–µ–∂–∫–∞: —Ç—É–∫ –ø–æ–¥–∞–≤–∞–º–µ h0 –Ω–∞ –ø—ä—Ä–≤–æ—Ç–æ –∏–∑–≤–∏–∫–≤–∞–Ω–µ; –ø—Ä–∏ –≤—Å—è–∫–æ —Å–ª–µ–¥–≤–∞—â–æ –∏–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ dfs() –≤ —Ü–∏–∫—ä–ª–∞ bound —Å–µ –æ–±–Ω–æ–≤—è–≤–∞ –∏ —Ä–µ–∫—É—Ä—Å–∏—è—Ç–∞ —â–µ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞ current_h –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª–Ω–æ.

---

## 6Ô∏è‚É£ –ì–ª–∞–≤–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è

```python
def main():
    N = int(input().strip())
    I = int(input().strip())
    n = int(math.sqrt(N + 1))

    tiles = []
    for _ in range(n):
        row = list(map(int, input().split()))
        tiles.extend(row)

    start = tuple(tiles)

    if I == -1:
        goal = tuple(list(range(1, N + 1)) + [0])
    else:
        goal = tuple(list(range(1, I + 1)) + [0] + list(range(I + 1, N + 1)))

    goal_positions = {tile: i for i, tile in enumerate(goal)}
    zero_pos = start.index(0)

    if not is_solvable(start, n, zero_pos):
        print(-1)
        return

    result = ida_star(start, goal, n, goal_positions, zero_pos)

    if result == -1:
        print(-1)
    else:
        print(len(result))
        for move in result:
            print(move)
```

---

## 7Ô∏è‚É£ –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ

```python
if __name__ == "__main__":
    main()
```

---

## –ó–∞—â–æ –∏ –∫–∞–∫ —Ä–∞–±–æ—Ç–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª–Ω–æ—Ç–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ h (Manhattan)

### –û—Å–Ω–æ–≤–Ω–∞ –∏–¥–µ—è

–ü—Ä–∏ –≤—Å—è–∫–∞ —Ä–∞–∑–º—è–Ω–∞ `0 ‚Üî tile`, —Å–∞–º–æ –µ–¥–Ω–∞ –ø–ª–æ—á–∫–∞ (`moved_tile`) –ø—Ä–æ–º–µ–Ω—è –ø–æ–∑–∏—Ü–∏—è—Ç–∞ —Å–∏. –ó–Ω–∞—á–∏ —Ü—è–ª–∞—Ç–∞ —Å—É–º–∞ `h` —Å–µ –ø—Ä–æ–º–µ–Ω—è —Å–∞–º–æ –∑–∞—Ä–∞–¥–∏ –Ω–µ—è:

```
h_new = h_old - dist(old_pos_of_tile, goal_pos) + dist(new_pos_of_tile, goal_pos)
```

### –í –∫–æ–¥–∞

- `new_zero` –µ —Å—Ç–∞—Ä–∞ –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –ø–ª–æ—á–∫–∞—Ç–∞ (–ø—Ä–µ–¥–∏ —Ä–∞–∑–º—è–Ω–∞—Ç–∞)
- `zero_idx` –µ –Ω–æ–≤–∞—Ç–∞ —ù –ø–æ–∑–∏—Ü–∏—è (—Å–ª–µ–¥ —Ä–∞–∑–º—è–Ω–∞—Ç–∞) ‚Äî —Ç–æ–≤–∞ –µ –º—è—Å—Ç–æ—Ç–æ –Ω–∞ —Å—Ç–∞—Ä–æ—Ç–æ 0
- –ò–∑–ø–æ–ª–∑–≤–∞–º–µ `divmod` –¥–∞ –ø—Ä–µ–≤—ä—Ä–Ω–µ–º –∏–Ω–¥–µ–∫—Å–∏ –≤ `(row, col)`
- –ü—Ä–µ—Å–º—è—Ç–∞–º–µ `old_dist` –∏ `new_dist` –∏ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–º–µ `current_h`

**–†–µ–∑—É–ª—Ç–∞—Ç:** –¢–æ–≤–∞ –ø—Ä–∞–≤–∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞ O(1) –≤–º–µ—Å—Ç–æ O(N). –ü—Ä–∏ –ø—ä–∑–µ–ª–∏, –∫–æ–∏—Ç–æ —Ä–∞–∑–≥–ª–µ–∂–¥–∞—Ç –º–∏–ª–∏–æ–Ω–∏ –≤—ä–∑–ª–∏, —Ç–æ–≤–∞ –µ –æ–≥—Ä–æ–º–Ω–∞ –∏–∫–æ–Ω–æ–º–∏—è.

---

## –ó–∞—â–æ –ø—Ä–∞–≤–∏–º path.append / path.pop –∏ –∑–∞—â–æ —Å—Ä–∞–≤–Ω—è–≤–∞–º–µ —Å path[-2]

`path` —Å—ä–¥—ä—Ä–∂–∞ –∞–∫—Ç–∏–≤–Ω–∏—è –ø—ä—Ç –æ—Ç –Ω–∞—á–∞–ª–æ—Ç–æ –¥–æ —Ç–µ–∫—É—â–∏—è –≤—ä–∑–µ–ª. –¢–æ–≤–∞ –µ –Ω—É–∂–Ω–æ, –∑–∞ –¥–∞ –º–æ–∂–µ–º:

1. –î–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏–º –¥–∏—Ä–µ–∫—Ç–µ–Ω –æ–±—Ä–∞—Ç–µ–Ω —Ö–æ–¥ (A‚ÜíB‚ÜíA), –∫–æ–µ—Ç–æ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª–Ω–æ —É–≤–µ–ª–∏—á–∞–≤–∞ –¥—ä—Ä–≤–æ—Ç–æ
2. –î–∞ –≤—ä—Ä–Ω–µ–º —Ç–æ—á–Ω–æ –ø—ä—Ç—è, –∫–æ–≥–∞—Ç–æ –¥–æ—Å—Ç–∏–≥–Ω–µ–º —Ü–µ–ª—Ç–∞ (—Å–≥–ª–æ–±—è–≤–∞–Ω–µ –Ω–∞ —Ö–æ–¥–æ–≤–µ—Ç–µ –æ—Ç–¥–æ–ª—É –Ω–∞–≥–æ—Ä–µ)

### –ú–µ—Ö–∞–Ω–∏–∑—ä–º

- `path[-1]` –µ —Ç–µ–∫—É—â–∏—è—Ç –≤—ä–∑–µ–ª
- `path[-2]` –µ —Ä–æ–¥–∏—Ç–µ–ª—è—Ç (–æ—Ç –∫–æ–π—Ç–æ —Å–º–µ –¥–æ—à–ª–∏)

–ê–∫–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–º–µ `new_board == path[-2]` ‚Äî —Ç–æ–≤–∞ –æ–∑–Ω–∞—á–∞–≤–∞ "–≤—Ä—ä—â–∞–Ω–µ –æ–±—Ä–∞—Ç–Ω–æ". –¢–∞–∫—ä–≤ —Ö–æ–¥ –µ –±–µ–∑—Å–º–∏—Å–ª–µ–Ω –∏ —Å–µ –ø—Ä–µ—Å–∫–∞—á–∞ (–ø—Ä–∏–Ω—Ü–∏–ø–Ω–æ A‚ÜíB‚ÜíA –Ω–µ –≤–æ–¥–∏ –¥–æ –æ–ø—Ç–∏–º–∞–ª–Ω–æ —Ä–µ—à–µ–Ω–∏–µ –∏ —É–¥–≤–æ—è–≤–∞ –Ω–µ–Ω—É–∂–Ω–æ –¥—ä—Ä–≤–æ—Ç–æ).

```python
if len(path) > 1 and new_board == path[-2]:
    continue
```

---

## –ü–æ—Å–æ–∫–∏—Ç–µ (left/up/right/down) ‚Äî –∫–∞–∫ —Å–∞ —Å—ä–æ—Ç–Ω–µ—Å–µ–Ω–∏ –∫—ä–º –¥–≤–∏–∂–µ–Ω–∏–µ—Ç–æ –Ω–∞ 0 –∏ –∫—ä–º –¥–≤–∏–∂–µ–Ω–∏–µ—Ç–æ –Ω–∞ –ø–ª–æ—á–∫–∞—Ç–∞

### –í–∞–∂–Ω–æ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

–í –∫–æ–¥–∞:

```python
moves = [(-1,0,"down"), (1,0,"up"), (0,-1,"right"), (0,1,"left")]
```

- –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏—Ç–µ `(dx, dy)` –æ–ø–∏—Å–≤–∞—Ç **–¥–≤–∏–∂–µ–Ω–∏–µ—Ç–æ –Ω–∞ 0** –≤ –º–∞—Ç—Ä–∏—Ü–∞—Ç–∞ (–∑–∞—â–æ—Ç–æ –Ω–∏–µ –∏–∑—á–∏—Å–ª—è–≤–∞–º–µ –Ω–æ–≤–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–∞ 0: `x = x0 + dx`, `y = y0 + dy`)
- –ò–º–µ–Ω–∞—Ç–∞ `"down"` / `"up"` / `"left"` / `"right"` –æ–±–∞—á–µ —Å–º–µ –∏–∑–±—Ä–∞–ª–∏ –¥–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤—è—Ç **—Ä–µ–∞–ª–Ω–æ—Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞ –ø–ª–æ—á–∫–∞—Ç–∞**, –∞ –Ω–µ –Ω–∞ 0

–¢–æ–≤–∞ –µ –Ω–∞–ø—Ä–∞–≤–µ–Ω–æ —Ç–∞–∫–∞, —á–µ –¥–∞ —Å–µ –ø–æ–ª—É—á–∏ –ø–æ-–∏–Ω—Ç—É–∏—Ç–∏–≤–µ–Ω –∏–∑—Ö–æ–¥ (—á–æ–≤–µ–∫ –≥–ª–µ–¥–∞ –∫–æ–π –Ω–∞–∫—ä–¥–µ –µ –ø—Ä–∏–¥–≤–∏–∂–µ–Ω).

### –ü—Ä–∏–º–µ—Ä

–ö–æ–≥–∞—Ç–æ 0 ‚Äû—Å–µ –º–µ—Å—Ç–∏ –Ω–∞–≥–æ—Ä–µ" (`dx = -1`), —Ç–æ–≤–∞ –æ–∑–Ω–∞—á–∞–≤–∞, —á–µ –ø–ª–æ—á–∫–∞—Ç–∞, –∫–æ—è—Ç–æ –µ –±–∏–ª–∞ –Ω–∞–¥ 0, –≤—Å—ä—â–Ω–æ—Å—Ç –µ –ø—Ä–µ–º–µ—Å—Ç–µ–Ω–∞ **–Ω–∞–¥–æ–ª—É** –≤ 0 ‚Äî –∑–∞—Ç–æ–≤–∞ –∏–º–µ `"down"`.

**–ê–∫–æ –∏—Å–∫–∞—à –∏–º–µ–Ω–∞—Ç–∞ –¥–∞ –æ–ø–∏—Å–≤–∞—Ç –¥–≤–∏–∂–µ–Ω–∏–µ—Ç–æ –Ω–∞ 0** (–∞ –Ω–µ –Ω–∞ –ø–ª–æ—á–∫–∏—Ç–µ), —Ç—Ä—è–±–≤–∞ –¥–∞ –≥–∏ –æ–±—ä—Ä–Ω–µ—à.

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å—ä–≤–µ—Ç

–ê–∫–æ –Ω–∞–±–ª—é–¥–∞–≤–∞—à ‚Äû–æ–≥–ª–µ–¥–∞–ª–Ω–∏" —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ (–Ω–∞–ø—Ä. –ø–æ–ª—É—á–∞–≤–∞—à `right right`, –∞ –æ—á–∞–∫–≤–∞—à `left left`), –ø—Ä–æ–≤–µ—Ä–∏ —Ç–∞–∑–∏ –∞—Å–æ—Ü–∏–∞—Ü–∏—è –Ω–∞ –∏–º–µ–Ω–∞—Ç–∞ –∏ –æ–±—ä—Ä–Ω–∏ –ø—Ä–∏ –Ω—É–∂–¥–∞.

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ —Ä–µ—à–∏–º–æ—Å—Ç (–∏–Ω–≤–µ—Ä—Å–∏–∏) ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ —á–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–∏ –≥—Ä–µ—à–∫–∏

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

`inversions` = –±—Ä–æ–π –¥–≤–æ–π–∫–∏ `(i < j)` —Ç–∞–∫–∏–≤–∞, —á–µ `tile_i > tile_j` –ø—Ä–∏ –ª–∏–Ω–µ–π–Ω–æ —á–µ—Ç–µ–Ω–µ (row-major), **–±–µ–∑ 0**.

### –ü—Ä–∞–≤–∏–ª–∞ –∑–∞ —Ä–µ—à–∏–º–æ—Å—Ç

#### –ê–∫–æ n (—Å—Ç—Ä–∞–Ω–∞) –µ –Ω–µ—á–µ—Ç–Ω–∞:

- –ü—ä–∑–µ–ª—ä—Ç –µ —Ä–µ—à–∏–º ‚Üî `inversions` –µ —á–µ—Ç–Ω–æ

#### –ê–∫–æ n –µ —á–µ—Ç–Ω–∞:

- –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç –µ `(inversions + row_of_blank)` (row –æ—Ç–≥–æ—Ä–µ, 0-based)
- –ü—ä–∑–µ–ª—ä—Ç –µ —Ä–µ—à–∏–º ‚Üî `(inversions + row_of_blank) % 2 == 1`

–¢–æ–≤–∞ –µ –ø—Ä–∞–≤–∏–ª–æ—Ç–æ, –∫–æ–µ—Ç–æ –∫–æ–¥—ä—Ç –∏–∑–ø–æ–ª–∑–≤–∞.

### –ß–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–∏ –≥—Ä–µ—à–∫–∏

1. **–ì—Ä–µ—à–Ω–æ –±—Ä–æ–µ–Ω–µ –Ω–∞ —Ä–µ–¥–∞ –Ω–∞ –ø—Ä–∞–∑–Ω–æ—Ç–æ** –æ—Ç –¥–æ–ª—É –≤–º–µ—Å—Ç–æ –æ—Ç–≥–æ—Ä–µ (–≤ –∫–æ–¥–∞ –µ –æ—Ç–≥–æ—Ä–µ, 0-based)
2. **–í—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ I** (–ø–æ–∑–∏—Ü–∏—è—Ç–∞ –Ω–∞ 0 –≤ —Ü–µ–ª—Ç–∞) 1-based –≤–º–µ—Å—Ç–æ 0-based; –∞–∫–æ –Ω–µ —Å–∏ —Å–∏–≥—É—Ä–µ–Ω –∑–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ I, –Ω–∞–ø—Ä–∞–≤–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏/–∏–ª–∏ –ø–æ–¥–∞–π debug output

---

## –ö–∞–∫–≤–æ —Ç–æ—á–Ω–æ –≤—Ä—ä—â–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏—Ç–µ –∏ –∫–∞–∫ —Å–µ —Ñ–æ—Ä–º–∏—Ä–∞ –∏–∑—Ö–æ–¥—ä—Ç

### `dfs` –≤—Ä—ä—â–∞ –∫–æ—Ä—Ç–µ–∂ `(result, moves)`

- **`result is True`** ‚Üí `moves` –µ —Å–ø–∏—Å—ä–∫ –æ—Ç —Ö–æ–¥–æ–≤–µ (—Å—Ç—Ä–æ–∫–∏—Ç–µ `"left"`, `"right"`, `"up"`, `"down"`) –æ—Ç —Ç–µ–∫—É—â–∏—è –≤—ä–∑–µ–ª –¥–æ —Ü–µ–ª—Ç–∞. –í —Ç–æ–∑–∏ —Å–ª—É—á–∞–π `dfs` –∫—É–º—É–ª–∏—Ä–∞ —Ö–æ–¥–∞ –ø—Ä–∏ –≤—Ä—ä—â–∞–Ω–µ—Ç–æ (`[move] + moves`) –∑–∞ –≤—Å—è–∫–∞ –≤–ª–æ–∂–µ–Ω–∞ —Ä–µ–∫—É—Ä—Å–∏—è
- **`result` –µ —á–∏—Å–ª–æ** (–º–∏–Ω–∏–º–∞–ª–Ω–∞—Ç–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç `f` –ø—Ä–µ–≤–∏—à–∏–ª–∞ `bound`) ‚Üí `moves` –µ `None`
- **`result == float('inf')`** ‚Üí –æ–∑–Ω–∞—á–∞–≤–∞ –∏–∑—á–µ—Ä–ø–≤–∞–Ω–µ (–Ω—è–º–∞ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏ –Ω–∏–∫–∞–∫–≤–∞ –≥—Ä–∞–Ω–∏—Ü–∞) ‚Üí –≤—Ä—ä—â–∞ —Å–µ `-1` –≤ `ida_star`

### `ida_star` –≤—Ä—ä—â–∞ `moves` –∏–ª–∏ `-1`

`main` –ø–µ—á–∞—Ç–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å—ä–æ—Ç–≤–µ—Ç–Ω–æ.
